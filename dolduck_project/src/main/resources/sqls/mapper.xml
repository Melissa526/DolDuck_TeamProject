<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="member">

	<!-- <resultMap type="MemberDto" id="MemberMap"> <result column="MEMBER_SEQ" 
		property="seq" /> <result column="MEMBER_ID" property="id" /> <result column="MEMBER_PW" 
		property="pw" /> <result column="MEMBER_NAME" property="name" /> <result 
		column="MEMBER_PHONE" property="phone" /> <result column="MEMBER_ADDR" property="addr" 
		/> <result column="MEMBER_EMAIL" property="email" /> <result column="MEMBER_REGDATE" 
		property="regdate" /> <result column="MEMBER_ENABLED" property="enabled" 
		/> <result column="MEMBER_ROLE" property="role" /> <result column="MEMBER_VOTE" 
		property="vote" /> </resultMap> -->

	<select id="selectList" resultType="SelectDto">
		SELECT * FROM MEMBER
	</select>
	<cache></cache>
	
	<select id="selectUser" resultType="java.util.Map">
		SELECT
		MEMBER_ID as username,
		MEMBER_PW as password,
		MEMBER_NAME as membername,
		MEMBER_ENABLED as enabled,
		MEMBER_ROLE as authority,
		MEMBER_SEQ,
		MEMBER_EMAIL,
		MEMBER_PHONE,
		MEMBER_ADDR,
		MEMBER_REGDATE,
		MEMBER_HEART,
		MEMBER_VOTE
		FROM MEMBER
		WHERE MEMBER_ID=#{member_id}
	</select>
	
	<!-- 등급변경 -->
	
	<update id="updateRole" parameterType="MemberDto">
		UPDATE MEMBER SET
		MEMBER_ROLE=#{member_role} 
		WHERE MEMBER_ID=#{member_id}
	</update>
	

	<insert id="insertUser" parameterType="map">
		INSERT INTO MEMBER
		VALUES(MEMBERSEQ.NEXTVAL,#{member_id},#{member_pw},#{member_name},#{member_phone},#{member_addr},#{member_email},SYSDATE,
		0, 1,'ROLE_USER',1)
	</insert>

	<!-- 회원가입 및 체크 -->
	<insert id="memberRegister" parameterType="MemberDto">
		INSERT INTO MEMBER
		VALUES(MEMBERSEQ.NEXTVAL,#{member_id},#{member_pw},#{member_name},#{member_phone},#{member_addr},#{member_email},
		SYSDATE, 0, 1, 'ROLE_USER',1)
	</insert>

	<select id="loginChk" parameterType="map" resultType="memberDto">
		SELECT *
		FROM MEMBER WHERE MEMBER_ID = #{member_id} AND MEMBER_PW =
		#{member_pw}
	</select>

	<select id="idChk" parameterType="String"
		resultType="com.my.test.dto.MemberJoinDto">
		SELECT * FROM MEMBER WHERE MEMBER_ID =#{member_id}
	</select>

	<select id="idSearch" parameterType="map" resultType="SelectDto">
		SELECT MEMBER_ID
		FROM MEMBER WHERE MEMBER_NAME=#{name} AND MEMBER_EMAIL=#{email}
	</select>

	<select id="pwSearch" parameterType="map" resultType="SelectDto">
		SELECT MEMBER_ID
		FROM MEMBER WHERE MEMBER_ID=#{id} AND MEMBER_EMAIL=#{email}
	</select>

	<update id="updateMember" parameterType="map">
		UPDATE MEMBER SET PW=#{pw}, PHONE=#{phone}, ADDR=#{addr},
		ZONECODE=#{zonecode} WHERE MEMBER_ID=#{id}
	</update>
	
	<update id="updateUserPw" parameterType="memberDto">
		UPDATE MEMBER SET PW=#{pw} WHERE USERSEQ=#{userseq}
	</update>

	<!-- 마켓: 하트 구매하기  -->
	<update id="purchaseHeart" parameterType="map">
		UPDATE MEMBER SET MEMBER_HEART = ((SELECT MEMBER_HEART FROM MEMBER WHERE MEMBER_ID = #{member_id}) + #{heart})
		WHERE MEMBER_ID = #{member_id}	
	</update>
	
	<!-- 마켓: 투표권 구매하기 -->
	<update id="purchaseVote" parameterType="map">
		UPDATE MEMBER 
		SET MEMBER_HEART = ((SELECT MEMBER_HEART FROM MEMBER WHERE MEMBER_ID = #{member_id}) - #{heart}),
			MEMBER_VOTE = ((SELECT MEMBER_VOTE FROM MEMBER WHERE MEMBER_ID = #{member_id}) + #{vote})
		WHERE MEMBER_ID = #{member_id}
	</update>

	<update id="changePw" parameterType="SelectDto">
		UPDATE MEMBER SET MEMBER_PW=#{pw} WHERE MEMBER_ID=#{id}
	</update>
	
	<update id="user_delete" parameterType="int">
		UPDATE LOGIN SET ENABLED='N' WHERE USERSEQ=#{userseq}
	</update>
		<insert id="insertVote" parameterType="com.my.test.vote.VoteDto">
		INSERT INTO VOTE
		VALUES(#{page}, #{starName}, #{voteNumber})
	</insert>
	
	<select id="selectOneVote" parameterType="com.my.test.vote.VoteDto" resultType="com.my.test.vote.VoteDto">
		SELECT * FROM VOTE
		WHERE VOTE_PAGE=#{page} AND VOTE_NAME=#{starName}
	</select>
	
	<update id="updateVote" parameterType="com.my.test.vote.VoteDto">
		UPDATE VOTE
		SET VOTE_TOTAL=((VOTE_TOTAL)+#{voteNumber})
		WHERE VOTE_PAGE=#{page} AND VOTE_NAME=#{starName}
	</update>
	
	
</mapper>
